<!DOCTYPE html>

<html lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="{{ config.icon_url | escape }}" type="{{ config.icon_mime | escape }}">
    <link rel="apple-touch-icon" href="{{ config.icon_url | escape }}" type="{{ config.icon_mime | escape }}">

    <meta name="msapplication-TileColor" content="{{ config.icon_color | escape }}">
    <meta name="msapplication-TileImage" content="{{ config.icon_url | escape }}">
    <meta property="og:image" content="{{ config.icon_url | escape }}">

    <title>Manager</title>

    <link rel="stylesheet" href="/assets/stylesheets/common.css?v={{ config.runtime_version | escape }}" type="text/css" />
    <link rel="stylesheet" href="/assets/stylesheets/index.css?v={{ config.runtime_version | escape }}" type="text/css" />

    <script src="/assets/javascripts/index.js?v={{ config.runtime_version | escape }}" type="text/javascript"></script>
    <script src="/assets/javascripts/jquery-3.7.1.min.js" type="text/javascript"></script>

    <script type="text/javascript">
      window.STATUS_GENERAL = '{{ states.status | escape }}';

      $(document).ready(function() {
        $('[id^=del_btn]').on('click', function(e) {
            var id = $(this).attr('name');
            $.ajax({
                type: 'DELETE',
                url: '/manager/announcement/' + id,
                success: (data) => {
                  $(this).closest('tr').remove();
                },
                error: (err) => {
                  console.log(err);
                },
            });
        });
        $('#new_anno_form').submit(function(e) {
            e.preventDefault();
            console.log(JSON.stringify($(this).serializeArray()));
            $.ajax({
                type: 'POST',
                url: $(this).attr('action'),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                data: JSON.stringify($(this).serializeArray()),
                success: (data) => {
                  console.log(data);
                },
                error: (err) => {
                  console.log(err);
                },
            });
        });
      });
    </script>

    {% if config.custom_html %}
      {{ config.custom_html | safe }}
    {% endif %}
  </head>

  <body>
    <header>
      <div class="wrapper">
        <div class="header-inner">
          <a href="/manager" class="logo">
            <img src="{{ config.logo_url | escape }}" alt="" />

            <span class="logo-label font-sans-semibold">Manager</span>
          </a>

          <nav>
            <ul>
              <li>
                <a href="/" target="_blank" class="nav-website font-sans-bold">Go back to Status</a>
              </li>
            </ul>
          </nav>

          <div class="clear"></div>
        </div>
      </div>
    </header>

    <main class="wrapper">
      <section class="manager">
        <h2>Announcments</h2>
        <table>
          <thead class="font-sans-semibold">
            <tr>
              <th>Type</th>
              <th>Title</th>
              <th>Text</th>
              <th>Delete?</th>
            </tr>
          </thead>
          <tbody class="font-sans-regular">
            {% for announcement in announcements | reverse %}
            <tr>
              <td>N/a</td>
              <td>{{ announcement.title | escape }}</td>
              <td>{{ announcement.text | escape | linebreaksbr }}</td>
              <td>
                <button id="del_btn_{{ loop.index0 }}" name="{{ announcement.id }}" class="btn danger">Delete</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <h2>Add Announcments</h2>
        <form id="new_anno_form" action="/manager/announcement" method="post">
          <label for="anno_title">Title:</label>
          <input type="text" id="anno_title" name="title" required><br>
          <label for="anno_text">Text:</label><br>
          <textarea id="anno_text" name="text" required></textarea><br>
          <input type="submit" value="Submit">
        </form>
      </section>
    </main>

    <footer class="wrapper">
      <p class="font-sans-semibold">© {{ environment.year }} {{ config.company_name | escape }}</p>
      <p class="font-sans-regular">This status page is powered by <a href="https://github.com/valeriansaliou/vigil" target="_blank" class="font-sans-semibold">Vigil</a>.</p>
    </footer>
  </body>
</html>
